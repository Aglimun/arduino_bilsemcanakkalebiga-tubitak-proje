<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Arduino SensÃ¶r Dashboardu | IndexedDB KayÄ±tlÄ± & Grafik</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
Â  /* GENEL STÄ°L VE FONT */
Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
Â  :root {
Â  Â  --bg-primary: #f0f4f8;
Â  Â  --bg-secondary: #ffffff;
Â  Â  --text-color: #333333;
Â  Â  --text-muted: #6c757d;
Â  Â  --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
Â  Â  --accent-color: #2196f3;
Â  }
Â  .dark-mode {
Â  Â  --bg-primary: #1e1e2d;
Â  Â  --bg-secondary: #27293d;
Â  Â  --text-color: #ffffff;
Â  Â  --text-muted: #a0a0a0;
Â  Â  --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
Â  Â  --accent-color: #4CAF50;
Â  }

Â  body {Â 
Â  Â  font-family: 'Inter', sans-serif;Â 
Â  Â  background: var(--bg-primary);Â 
Â  Â  margin: 0;Â 
Â  Â  padding: 25px;
Â  Â  color: var(--text-color);
Â  Â  transition: background-color 0.3s;
Â  }
Â  .header {
Â  Â  display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
Â  }
Â  h1 { margin: 0; color: var(--text-color); font-weight: 600; }
Â  .action-buttons button {
Â  Â  padding: 10px 20px; font-size: 14px; border: none;
Â  Â  border-radius: 8px; cursor: pointer; transition: background-color 0.3s, opacity 0.3s;
Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
Â  }
Â  #connect { background-color: var(--accent-color); color: white; margin-right: 15px; }
Â  #connect:hover { opacity: 0.9; }
Â  #modeToggle { background-color: var(--bg-secondary); color: var(--text-color); border: 1px solid var(--text-color); }
Â  #modeToggle:hover { background-color: rgba(255, 255, 255, 0.1); }

Â  /* KART VE DÃœZEN */
Â  .dashboard-grid {
Â  Â  display: grid;
Â  Â  grid-template-columns: 2fr 1fr;
Â  Â  gap: 25px;
Â  }
Â  .card-container { display: flex; gap: 25px; margin-bottom: 25px; }
Â  .card {Â 
Â  Â  background: var(--bg-secondary); padding: 20px; border-radius: 12px;Â 
Â  Â  box-shadow: var(--card-shadow); width: 100%; text-align: left;
Â  Â  transition: background-color 0.3s, box-shadow 0.3s;
Â  }
Â  .card h3 { margin: 0 0 10px; color: var(--text-muted); font-weight: 400; font-size: 0.9em; display: flex; align-items: center; }
Â  .metric-value { font-size: 2.5em; font-weight: 700; color: var(--text-color); margin-top: 5px; }

Â  /* BARLAR VE DURUM GÃ–STERGELERÄ° */
Â  .bar-container { height: 8px; background: var(--text-muted); border-radius: 5px; overflow: hidden; margin-top: 15px; }
Â  .bar-fill { height: 100%; transition: width 0.3s ease; }
Â  #soilBar { background-color: #4CAF50; }
Â  #potBar { background-color: #ff9800; }
Â  .status-info { margin-top: 15px; font-weight: 600; display: flex; align-items: center; }
Â  .status-indicator {
Â  Â  width: 10px; height: 10px; border-radius: 50%; margin-right: 8px;
Â  Â  background: #f44336; box-shadow: 0 0 8px rgba(244, 67, 54, 0.5);
Â  Â  transition: background-color 0.3s, box-shadow 0.3s;
Â  }
Â  #pump[data-status="1"] .status-indicator { background: #4CAF50; box-shadow: 0 0 8px rgba(76, 175, 80, 0.8); }
Â  .led-card .status-indicator { width: 25px; height: 25px; margin-top: 10px; display: block; }
Â  .led-card.cold .status-indicator { background: #2196f3; box-shadow: 0 0 15px #2196f3; }
Â  .led-card.warm .status-indicator { background: #f44336; box-shadow: 0 0 15px #f44336; }
Â  .led-card.normal .status-indicator { background: #4CAF50; box-shadow: 0 0 15px #4CAF50; }

Â  /* YENÄ° EKLENEN KUTULAR Ä°Ã‡Ä°N STÄ°L */
Â  .chart-area { grid-column: 1 / 2; }
Â  .sidebar { grid-column: 2 / 3; display: grid; grid-template-rows: 1fr 1fr; gap: 25px; }
Â  /* CHART STÄ°LÄ° */
Â  #sensorChart { background: var(--bg-secondary); }

</style>
</head>
<body class="dark-mode">Â 

<div class="header">
Â  <h1>âš™ï¸ Arduino SensÃ¶r Dashboardu</h1>
Â  <div class="action-buttons">
Â  Â  <button id="connect">ğŸ”Œ BaÄŸlan</button>
Â  Â  <button id="modeToggle">â˜€ï¸ AÃ§Ä±k Tema</button>
Â  </div>
</div>

<div class="dashboard-grid">
Â  <div>
Â  Â  <div class="card-container">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>ğŸ’§ TOPRAK NEMÄ°</h3>
Â  Â  Â  Â  <div id="soil" class="metric-value">0%</div>
Â  Â  Â  Â  <div class="bar-container"><div id="soilBar" class="bar-fill" style="width:0%"></div></div>
Â  Â  Â  Â  <div id="pump" data-status="0" class="status-info">
Â  Â  Â  Â  Â  <span class="status-indicator"></span> Pompa KapalÄ±
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>âš™ï¸ POTANSÄ°YOMETRE</h3>
Â  Â  Â  Â  <div id="pot" class="metric-value">0</div>
Â  Â  Â  Â  <div class="bar-container"><div id="potBar" class="bar-fill" style="width:0%"></div></div>
Â  Â  Â  Â  <div class="status-info" style="color: var(--text-muted);">0-1023 DeÄŸeri</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="card led-card" id="temperature">
Â  Â  Â  Â  <h3>ğŸŒ¡ï¸ SICAKLIK</h3>
Â  Â  Â  Â  <div id="temp" class="metric-value">0Â°C</div>
Â  Â  Â  Â  <div class="status-info">
Â  Â  Â  Â  Â  Durum: Normal
Â  Â  Â  Â  Â  <div id="tempLed" class="status-indicator"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="card chart-area">
Â  Â  Â  <h3>ğŸ“ˆ TÃœM SENSÃ–R VERÄ°LERÄ° GEÃ‡MÄ°ÅÄ° (Son 20 Ã–lÃ§Ã¼m)</h3>
Â  Â  Â  <div id="chart-placeholder" style="height: 350px;">
Â  Â  Â  Â  <canvas id="sensorChart"></canvas>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div class="sidebar">
Â  Â  <div class="card">
Â  Â  Â  <h3>â˜€ï¸ TAHMÄ°N / PROGNOZ</h3>
Â  Â  Â  <div class="metric-value" id="prediction-value">BaÄŸlanÄ±yor...</div>
Â  Â  Â  <p style="color: var(--text-muted); font-size: 0.9em; margin-top: 10px;">
Â  Â  Â  Â  Veriler IndexedDB'den geldikten sonra hesaplanÄ±r.
Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h3>âœ… SÄ°STEM Ã–ZETÄ°</h3>
Â  Â  Â  <ul style="list-style: none; padding: 0; color: var(--text-color);">
Â  Â  Â  Â  <li style="color: #4CAF50; margin-bottom: 5px;">Depolama Durumu: <span id="server-status">IndexedDB HazÄ±rlanÄ±yor...</span></li>
Â  Â  Â  Â  <li style="color: #ff9800; margin-bottom: 5px;">Pompa: **Otomatik Kontrol**</li>
Â  Â  Â  Â  <li style="color: var(--text-muted);">BaÄŸlantÄ±: **Seri Port Aktif**</li>
Â  Â  Â  </ul>
Â  Â  </div>
Â  </div>
</div>

<script>
// --- SABÄ°TLER VE DEÄÄ°ÅKENLER ---
let port;
let reader;
let buffer = "";Â 

const CHART_VISIBLE_POINTS = 20; // Grafikte gÃ¶sterilecek maksimum nokta sayÄ±sÄ±

// IndexedDB Sabitleri (150 MB limit iÃ§in)
const DB_NAME = 'SensorDataDB';
const DB_VERSION = 1;
const STORE_NAME = 'LogEntries';
// 150 MB = 157,286,400 bytes
const MAX_STORAGE_BYTES = 157286400; 
let db;

// Grafik ve ArayÃ¼z DeÄŸiÅŸkenleri
let sensorChart;
const serverStatusEl = document.getElementById("server-status");

// -----------------------------------------------------------
// 1. INDEXEDDB Ä°ÅLEMLERÄ° (PHP YERÄ°NE GEÃ‡EN KISIM)
// -----------------------------------------------------------

/** IndexedDB'yi baÅŸlatÄ±r ve veritabanÄ±nÄ± aÃ§ar. */
function openDB() {
    return new Promise((resolve, reject) => {
        if (!window.indexedDB) {
            serverStatusEl.textContent = "HATA: TarayÄ±cÄ±nÄ±z IndexedDB'yi desteklemiyor!";
            return reject("IndexedDB not supported.");
        }
        
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = (event) => {
            serverStatusEl.textContent = `Hata: IndexedDB aÃ§Ä±lamadÄ±.`;
            reject('Database error: ' + event.target.errorCode);
        };

        request.onsuccess = (event) => {
            db = event.target.result;
            serverStatusEl.textContent = `IndexedDB HazÄ±r.`;
            resolve(db);
        };

        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                // 'id' autoIncrement primary key olarak FIFO iÃ§in kullanÄ±lÄ±r.
                db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
            }
        };
    });
}

/** Veri boyutunu yaklaÅŸÄ±k olarak hesaplar. */
async function calculateCurrentSize(transaction) {
    return new Promise((resolve, reject) => {
        const tx = transaction || db.transaction(STORE_NAME, 'readonly');
        const store = tx.objectStore(STORE_NAME);
        const request = store.openCursor();
        let totalSize = 0;

        request.onsuccess = (event) => {
            const cursor = event.target.result;
            if (cursor) {
                // JSON string uzunluÄŸu ile bayt sayÄ±sÄ±nÄ± simÃ¼le etme
                totalSize += JSON.stringify(cursor.value).length;
                cursor.continue();
            } else {
                resolve(totalSize);
            }
        };
        request.onerror = reject;
    });
}

/** 150 MB limitini kontrol eder ve gerekirse en eski verileri (FIFO) siler. */
async function enforceSizeLimit(newEntrySize) {
    if (!db) return;
    
    let currentSize = await calculateCurrentSize();
    let sizeNeeded = (currentSize + newEntrySize) - MAX_STORAGE_BYTES;

    if (sizeNeeded > 0) {
        const tx = db.transaction(STORE_NAME, 'readwrite');
        const store = tx.objectStore(STORE_NAME);
        const request = store.openCursor();
        let deletionCount = 0;

        await new Promise((resolve, reject) => {
            request.onsuccess = (event) => {
                const cursor = event.target.result;
                if (cursor && sizeNeeded > 0) {
                    const entryId = cursor.value.id;
                    const entrySize = JSON.stringify(cursor.value).length;
                    
                    // En eski kaydÄ± sil
                    store.delete(entryId).onsuccess = () => {
                        sizeNeeded -= entrySize;
                        deletionCount++;
                        cursor.continue(); 
                    };
                    store.delete(entryId).onerror = reject;
                } else {
                    resolve();
                }
            };
            request.onerror = reject;
        });

        serverStatusEl.textContent = `Limit AÅŸÄ±ldÄ±! ${deletionCount} kayÄ±t silinip yer aÃ§Ä±ldÄ±.`;
    }
}

/** Yeni veri noktasÄ±nÄ± IndexedDB'ye kaydeder. */
async function saveDataToIndexedDB(dataPoint) {
    if (!db) return;

    try {
        const newEntrySize = JSON.stringify(dataPoint).length;
        
        // 1. Limit kontrolÃ¼ ve FIFO silme iÅŸlemi
        await enforceSizeLimit(newEntrySize);

        // 2. Yeni veriyi ekleme
        const tx = db.transaction(STORE_NAME, 'readwrite');
        const store = tx.objectStore(STORE_NAME);
        
        const request = store.add(dataPoint);

        request.onsuccess = async () => {
            serverStatusEl.textContent = `IndexedDB HazÄ±r. (${(await calculateCurrentSize() / 1048576).toFixed(2)} MB)`;
        };

        request.onerror = (event) => {
            console.error("KayÄ±t ekleme hatasÄ±:", event.target.error);
        };
    } catch (error) {
        console.error("IndexedDB iÅŸlem hatasÄ±:", error);
    }
}

/** TÃ¼m geÃ§miÅŸ verileri IndexedDB'den Ã§eker. */
async function loadDataFromIndexedDB() {
    if (!db) return [];

    return new Promise((resolve, reject) => {
        const tx = db.transaction(STORE_NAME, 'readonly');
        const store = tx.objectStore(STORE_NAME);
        const request = store.getAll(); // TÃ¼m veriyi Ã§ek

        request.onsuccess = (event) => {
            const history = event.target.result;
            // history dizisi [en eski, ..., en yeni] ÅŸeklinde gelir.
            
            // Sadece CHART_VISIBLE_POINTS kadar en son veriyi al
            const latestHistory = history.slice(-CHART_VISIBLE_POINTS); 

            if (history.length > 0) {
                updatePrediction(history[history.length - 1].sic);
            }
            resolve(latestHistory);
        };
        request.onerror = reject;
    });
}

// -----------------------------------------------------------
// 2. CHART.JS Ä°ÅLEMLERÄ°
// -----------------------------------------------------------

function initializeChart() {
    const ctx = document.getElementById('sensorChart').getContext('2d');
    sensorChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],Â 
            datasets: [{
                label: 'SÄ±caklÄ±k (Â°C)',
                data: [],
                borderColor: '#f44336', 
                tension: 0.2, fill: false, yAxisID: 'yTemp'
            },
            {
                label: 'Nem (%)',
                data: [],
                borderColor: '#2196f3', 
                tension: 0.2, fill: false, yAxisID: 'yNemPot'
            },
            {
                label: 'Potansiyometre (0-1023)',
                data: [],
                borderColor: '#ff9800', 
                tension: 0.2, fill: false, yAxisID: 'yNemPot'
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: {
                x: {
                    display: true, title: { display: true, text: 'Zaman' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                yTemp: {
                    type: 'linear', display: true, position: 'left',
                    title: { display: true, text: 'SÄ±caklÄ±k (Â°C)' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                yNemPot: {
                    type: 'linear', display: true, position: 'right',
                    title: { display: true, text: 'Nem/Pot (0-1023)' },
                    min: 0, max: 1023,
                    grid: { drawOnChartArea: false }
                }
            },
            plugins: {
                legend: { labels: { color: 'white' } }Â 
            }
        }
    });
    // Ä°lk yÃ¼klemede grafiÄŸi IndexedDB verileriyle doldur
    refreshChartFromDB();
}

/** IndexedDB'den gelen verilerle grafiÄŸi gÃ¼nceller. */
function updateChart(history) {
    if (!sensorChart) return;
    
    // Tema renklerini al ve uygula
    const isDarkMode = document.body.classList.contains('dark-mode');
    const color = isDarkMode ? 'white' : 'black';
    
    // Eksen renklerini gÃ¼ncelle
    const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
    sensorChart.options.scales.x.ticks = { color: color };
    sensorChart.options.scales.x.grid = { color: gridColor };
    sensorChart.options.scales.yTemp.ticks = { color: color };
    sensorChart.options.scales.yTemp.grid = { color: gridColor };
    sensorChart.options.scales.yNemPot.ticks = { color: color };
    sensorChart.options.plugins.legend.labels.color = color;

    // Grafik verilerini hazÄ±rla (Sadece son CHART_VISIBLE_POINTS kadarÄ±nÄ± kullanÄ±rÄ±z)
    const labels = history.map(d => d.time);
    const nemData = history.map(d => d.nem);
    const sicData = history.map(d => d.sic);
    const potData = history.map(d => d.pot);

    sensorChart.data.labels = labels;
    sensorChart.data.datasets[0].data = sicData;
    sensorChart.data.datasets[1].data = nemData;
    sensorChart.data.datasets[2].data = potData;
    
    sensorChart.update();
}

/** IndexedDB'den verileri Ã§eker ve grafiÄŸi doldurur. */
async function refreshChartFromDB() {
    try {
        const history = await loadDataFromIndexedDB();
        updateChart(history);
    } catch (e) {
        console.error("GrafiÄŸi IndexedDB'den doldurma hatasÄ±:", e);
    }
}


// -----------------------------------------------------------
// 3. ARDUINO SERÄ° PORT Ä°ÅLEMLERÄ° (DEÄÄ°ÅMEDÄ°)
// -----------------------------------------------------------

document.getElementById("connect").addEventListener("click", async () => {
    if ("serial" in navigator) {
        try {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });
            document.getElementById("connect").innerText = "BaÄŸlanÄ±ldÄ± (Veri Geliyor...)";
            const textDecoder = new TextDecoderStream();
            port.readable.pipeTo(textDecoder.writable);
            reader = textDecoder.readable.getReader();
            readLoop();
        } catch (err) {
            alert("BaÄŸlantÄ± HatasÄ±: " + err);
        }
    } else {
        alert("TarayÄ±cÄ±nÄ±z Seri Port API'Ä±nÄ± desteklemiyor. (Sadece Chrome/Edge'de Ã§alÄ±ÅŸÄ±r.)");
    }
});

async function readLoop() {
    while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        if (value) {
            buffer += value;
            
            if (buffer.includes('\n')) {
                let lines = buffer.split('\n');
                buffer = lines.pop();Â 

                // GECÄ°KME Ã‡Ã–ZÃœMÃœ: Sadece en son geÃ§erli veriyi iÅŸleÂ 
                for (let i = lines.length - 1; i >= 0; i--) {
                    const line = lines[i].trim();
                    if (line.includes("nem:")) {
                        processLine(line);
                        break;Â 
                    }
                }
            }
        }
    }
}

// -----------------------------------------------------------
// 4. VERÄ° Ä°ÅLEME VE KAYIT (DEÄÄ°ÅTÄ°RÄ°LDÄ°)
// -----------------------------------------------------------

function processLine(data) {
    try {
        const parts = data.split(';');
        let latestValues = {};Â 

        parts.forEach(part => {
            const [key, val] = part.split(':');
            if (key && val) latestValues[key] = parseFloat(val);
        });

        updateDashboard(latestValues);
        
        // TÃ¼m deÄŸerler varsa IndexedDB'ye kaydet ve grafiÄŸi canlÄ± gÃ¼ncelle
        if (latestValues.sic !== undefined && latestValues.nem !== undefined && latestValues.pot !== undefined) {
            const dataPoint = {Â 
                // IndexedDB'de tutulacak veri yapÄ±sÄ±
                time: new Date().toLocaleTimeString(),Â 
                sic: latestValues.sic,
                nem: latestValues.nem,
                pot: latestValues.pot
            };
            
            // 1. IndexedDB'ye kaydet (FIFO mantÄ±ÄŸÄ± ile)
            saveDataToIndexedDB(dataPoint);Â 

            // 2. Grafik verisini canlÄ± olarak gÃ¼ncelle
            if (sensorChart) {
                const datasets = sensorChart.data.datasets;
                sensorChart.data.labels.push(dataPoint.time);
                datasets[0].data.push(dataPoint.sic);
                datasets[1].data.push(dataPoint.nem);
                datasets[2].data.push(dataPoint.pot);
                
                // Sadece son CHART_VISIBLE_POINTS (20) noktayÄ± gÃ¶stermek iÃ§in eskileri kaldÄ±r
                if (sensorChart.data.labels.length > CHART_VISIBLE_POINTS) {
                    sensorChart.data.labels.shift();
                    datasets.forEach(dataset => dataset.data.shift());
                }

                sensorChart.update();
                updatePrediction(dataPoint.sic);
            }
        }

    } catch (e) {
        console.error("Veri iÅŸleme hatasÄ±:", e);
    }
}

// -----------------------------------------------------------
// 5. DASHBOARD VE TAHMÄ°N FONKSÄ°YONLARI (DEÄÄ°ÅMEDÄ°)
// -----------------------------------------------------------

function updateDashboard(values) {
    if (values.nem !== undefined) {
      document.getElementById("soil").innerText = values.nem + "%";
      document.getElementById("soilBar").style.width = values.nem + "%";
    }

    if (values.pump !== undefined) {
      const pumpEl = document.getElementById("pump");
      pumpEl.querySelector('span').nextSibling.textContent = values.pump ? " Pompa AÃ§Ä±k" : " Pompa KapalÄ±";
      pumpEl.setAttribute("data-status", values.pump ? "1" : "0");
    }

    if (values.sic !== undefined) {
      document.getElementById("temp").innerText = values.sic.toFixed(1) + "Â°C";
      const ledCard = document.getElementById("temperature");
      ledCard.classList.remove("warm", "cold", "normal");
      
      let statusText = "Normal";
      if (values.sic < 15) {
        ledCard.classList.add("cold");
        statusText = "SoÄŸuk";
      } else if (values.sic > 27) {
        ledCard.classList.add("warm");
        statusText = "SÄ±cak";
      } else {
        ledCard.classList.add("normal");
      }
      ledCard.querySelector('.status-info').firstChild.textContent = `Durum: ${statusText} `;
    }

    if (values.pot !== undefined) {
      document.getElementById("pot").innerText = values.pot;
      document.getElementById("potBar").style.width = (values.pot / 1023 * 100) + "%";
    }
}

function updatePrediction(currentTemp) {
    if (currentTemp === undefined || isNaN(currentTemp)) return;

    let predictionText = currentTemp.toFixed(1) + "Â°C";

    if (currentTemp > 25) {
          predictionText += " (YÃ¼ksek EÄŸilim)";
    } else if (currentTemp < 17) {
          predictionText += " (DÃ¼ÅŸÃ¼k EÄŸilim)";
    } else {
          predictionText += " (Stabil)";
    }

    document.getElementById("prediction-value").innerText = predictionText;
}


// -----------------------------------------------------------
// 6. DARK MODE VE BAÅLANGIÃ‡ AYARLARI
// -----------------------------------------------------------

document.getElementById('modeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    document.getElementById('modeToggle').textContent = isDarkMode ? 'â˜€ï¸ AÃ§Ä±k Tema' : 'ğŸŒ™ Koyu Tema';
    
    // Tema deÄŸiÅŸiminde grafiÄŸi de gÃ¼ncelle (renkler iÃ§in)
    refreshChartFromDB();
});

document.addEventListener('DOMContentLoaded', async () => {
    // 1. IndexedDB'yi baÅŸlat
    await openDB();

    // 2. Tema baÅŸlangÄ±Ã§ ayarÄ±
    const isDarkMode = document.body.classList.contains('dark-mode');
    document.getElementById('modeToggle').textContent = isDarkMode ? 'â˜€ï¸ AÃ§Ä±k Tema' : 'ğŸŒ™ Koyu Tema';
    
    // 3. Grafik bileÅŸenini baÅŸlat ve IndexedDB'den verileri yÃ¼kle
    initializeChart();
});
</script>

</body>
</html>
